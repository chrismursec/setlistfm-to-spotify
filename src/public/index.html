<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spotify Login</title>
    <!-- <link rel="stylesheet" href="https://matcha.mizu.sh/matcha.css" /> -->
  </head>
  <body>
    <h1>Spotify Login</h1>
    <button onclick="login()">Login with Spotify</button>

    <hr />

    <input type="text" id="artist-name" placeholder="Artist Name" />
    <input type="text" id="setlistfm-link" placeholder="setlist.fm link" />
    <input type="text" id="playlist-name" placeholder="Playlist Name" />

    <button onclick="createPlaylist()">Create Playlist</button>

    <div id="userDetails"></div>

    <script>
      // Function to initiate the login process
      function login() {
        const clientId = "ba38ec33ae97465b860a00e2ac28a9fa"; // Replace with your Spotify client ID
        const redirectUri = "http://localhost:8080/api/callback"; // Replace with your redirect URI
        const scope =
          "user-read-private user-read-email playlist-modify-public"; // Adjust scopes as needed

        // Redirect the user to Spotify authorization page
        window.location.href = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=code&redirect_uri=${redirectUri}&scope=${scope}`;
      }

      // Function to get query parameters from the URL
      function getQueryParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const userDetails = urlParams.get("userDetails");
        return JSON.parse(userDetails);
      }

      // Function to save user details to local storage
      function saveUserDetailsToLocalStorage(userDetails) {
        localStorage.setItem("spotifyUserDetails", JSON.stringify(userDetails));
      }

      // Check if the URL contains user details
      const userDetails = getQueryParams();
      if (userDetails) {
        // Save user details to local storage
        saveUserDetailsToLocalStorage(userDetails);
        // Redirect the user to some other page if needed
        // window.location.href = "/some_other_page.html";
      }

      function createPlaylist() {
        let artistName = document.getElementById("artist-name").value;
        let setlistFmLink = document.getElementById("setlistfm-link").value;
        let playlistName = document.getElementById("playlist-name").value;

        // get access token from local storage
        const userDetails = JSON.parse(
          localStorage.getItem("spotifyUserDetails")
        );
        const accessToken = userDetails.accessToken;

        //post to localhost:3000/create-playlist
        fetch("http://localhost:8080/api/create-playlist", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            artistName: artistName,
            playlistName: playlistName,
            setlistFmLink: setlistFmLink,
            accessToken: accessToken,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>

    <script src="./main.js"></script>
  </body>
</html>
